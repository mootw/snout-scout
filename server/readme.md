# Info

The server acts as a central store of information that can handle the specific data format that snout-scout uses.
It is efficient, and can push chunks to clients in real time using web sockets. The server hosts on port 6749 by
default and it should be proxied over https for competition use using a reverse proxy like nginx. Web browsers generally allow insecure socket connections on localhost only, for local development this is fine. **The proxy must
support handling web socket upgrade requests or real time updates will not work.** 



The server also handles api requests to the FRC API to populate match data. This is an optional feature, and your api key can be set in .env in the executable directory.


# Docker


in the main root directory of the repo build the docker file 
`docker build -t snout-scout .`

run the container like this to expose the port, and also
bind the events directory to the container so that it can read
your event files.

`docker run -p 6749:6749 -v "$(pwd)"/events:/events snout-scout`


# Setup

Either compile or use a pre-compiled binary for the server.

`dart compile exe server.dart`

The directory should contain an events folder which will contain the json database files.


## Example nginx config

```
# Default server configuration
#
server {
        listen 80 default_server;
        listen [::]:80 default_server;


        root /var/www/html;

        # Add index.php to the list if you are using PHP
        index index.html index.htm index.nginx-debian.html;

        server_name _;

        location / {
                # First attempt to serve request as file, then
                # as directory, then fall back to displaying a 404.
                proxy_pass http://localhost:6749;

                # ALLOW FOR WEB SOCKET UPGRADE REQUESTS
                proxy_set_header Connection $http_connection;
                proxy_set_header Upgrade $http_upgrade;
        }

}

server {

        # SSL configuration
        #
        # listen 443 ssl default_server;
        # listen [::]:443 ssl default_server;
        #
        # Note: You should disable gzip for SSL traffic.
        # See: https://bugs.debian.org/773332
        #
        # Read up on ssl_ciphers to ensure a secure configuration.
        # See: https://bugs.debian.org/765782
        #
        # Self signed certs generated by the ssl-cert package
        # Don't use them in a production server!
        #
        # include snippets/snakeoil.conf;

        root /var/www/html;

        # Add index.php to the list if you are using PHP
        index index.html index.htm index.nginx-debian.html;
    server_name yourdomain.com; # managed by Certbot


        location / {
                # First attempt to serve request as file, then
                # as directory, then fall back to displaying a 404.
                proxy_pass http://localhost:6749;
                proxy_set_header Connection $http_connection;
                proxy_set_header Upgrade $http_upgrade;
        }

    listen [::]:443 ssl ipv6only=on; # managed by Certbot
    listen 443 ssl; # managed by Certbot
    ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem; # managed by Certbot
    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot

}
server {
    if ($host = yourdomain.com) {
        return 301 https://$host$request_uri;
    } # managed by Certbot


        listen 80 ;
        listen [::]:80 ;
    server_name yourdomain.com;
    return 404; # managed by Certbot
}
```